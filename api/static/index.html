<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fraud Detection Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS Variables & Reset
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --bg: #0a0e1a;
      --bg2: #111827;
      --bg3: #1f2937;
      --bg4: #374151;
      --surface: rgba(17, 24, 39, 0.85);
      --border: rgba(99, 102, 241, 0.15);
      --text: #e5e7eb;
      --text2: #9ca3af;
      --text3: #6b7280;
      --accent: #6366f1;
      --accent2: #818cf8;
      --green: #10b981;
      --green-bg: rgba(16, 185, 129, 0.1);
      --yellow: #f59e0b;
      --yellow-bg: rgba(245, 158, 11, 0.1);
      --orange: #f97316;
      --orange-bg: rgba(249, 115, 22, 0.1);
      --red: #ef4444;
      --red-bg: rgba(239, 68, 68, 0.1);
      --critical: #dc2626;
      --critical-bg: rgba(220, 38, 38, 0.15);
      --radius: 12px;
      --radius-sm: 8px;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      --glass: rgba(255, 255, 255, 0.03);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Background Effect
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(ellipse at 20% 50%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 20%, rgba(16, 185, 129, 0.05) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 80%, rgba(239, 68, 68, 0.04) 0%, transparent 50%);
      z-index: 0;
      animation: bgShift 20s ease-in-out infinite alternate;
    }

    @keyframes bgShift {
      0% {
        transform: translate(0, 0) rotate(0deg);
      }

      100% {
        transform: translate(-2%, -1%) rotate(1deg);
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Layout
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .app {
      position: relative;
      z-index: 1;
    }

    .navbar {
      background: rgba(10, 14, 26, 0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 0 32px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .navbar h1 {
      font-size: 18px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--accent2), var(--green));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .navbar h1 span {
      font-size: 22px;
    }

    .status-pill {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--green-bg);
      color: var(--green);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: var(--green);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {

      0%,
      100% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: 0.5;
        transform: scale(0.8);
      }
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 28px 32px;
    }

    /* Stats Bar */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 28px;
    }

    .stat-card {
      background: var(--surface);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(99, 102, 241, 0.1);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text3);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 800;
    }

    .stat-sub {
      font-size: 12px;
      color: var(--text2);
      margin-top: 4px;
    }

    /* Main Grid */
    .main-grid {
      display: grid;
      grid-template-columns: 420px 1fr;
      gap: 24px;
      align-items: start;
    }

    /* Card */
    .card {
      background: var(--surface);
      backdrop-filter: blur(12px);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
    }

    .card-header {
      padding: 18px 22px;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-body {
      padding: 22px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Form
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text2);
      text-transform: uppercase;
      letter-spacing: 0.8px;
      margin-bottom: 6px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 10px 14px;
      color: var(--text);
      font-family: inherit;
      font-size: 14px;
      transition: border-color 0.2s;
      outline: none;
    }

    .form-group input:focus,
    .form-group select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
    }

    .form-group input::placeholder {
      color: var(--text3);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .btn-score {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--accent), #4f46e5);
      color: white;
      border: none;
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
    }

    .btn-score:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
    }

    .btn-score:active {
      transform: translateY(0);
    }

    .btn-score:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn-score .spinner {
      display: none;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.6s linear infinite;
    }

    .btn-score.loading .spinner {
      display: block;
    }

    .btn-score.loading .btn-text {
      display: none;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Quick presets */
    .presets {
      margin-bottom: 16px;
    }

    .presets-label {
      font-size: 11px;
      color: var(--text3);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .preset-btns {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .preset-btn {
      padding: 6px 12px;
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text2);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      font-family: inherit;
    }

    .preset-btn:hover {
      border-color: var(--accent);
      color: var(--accent2);
      background: rgba(99, 102, 241, 0.08);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Result Panel
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .result-panel {
      display: none;
    }

    .result-panel.visible {
      display: block;
    }

    /* Gauge */
    .gauge-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 0 10px;
    }

    .gauge-container {
      position: relative;
      width: 220px;
      height: 130px;
    }

    .gauge-svg {
      width: 220px;
      height: 130px;
    }

    .gauge-bg {
      fill: none;
      stroke: var(--bg3);
      stroke-width: 14;
      stroke-linecap: round;
    }

    .gauge-fill {
      fill: none;
      stroke-width: 14;
      stroke-linecap: round;
      transition: stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1), stroke 0.5s;
    }

    .gauge-score {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      font-size: 48px;
      font-weight: 800;
      line-height: 1;
    }

    .gauge-label {
      font-size: 13px;
      color: var(--text2);
      margin-top: 8px;
    }

    /* Risk Badge */
    .risk-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 18px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 1px;
      margin-top: 14px;
      animation: badgePop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes badgePop {
      0% {
        transform: scale(0.7);
        opacity: 0;
      }

      100% {
        transform: scale(1);
        opacity: 1;
      }
    }

    .risk-MINIMAL {
      background: var(--green-bg);
      color: var(--green);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .risk-LOW {
      background: var(--green-bg);
      color: var(--green);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .risk-MEDIUM {
      background: var(--yellow-bg);
      color: var(--yellow);
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .risk-HIGH {
      background: var(--orange-bg);
      color: var(--orange);
      border: 1px solid rgba(249, 115, 22, 0.3);
    }

    .risk-CRITICAL {
      background: var(--critical-bg);
      color: var(--critical);
      border: 1px solid rgba(220, 38, 38, 0.3);
    }

    /* Details */
    .result-details {
      margin-top: 24px;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
      font-size: 14px;
    }

    .detail-row:last-child {
      border: none;
    }

    .detail-key {
      color: var(--text2);
    }

    .detail-val {
      font-weight: 600;
    }

    /* Reasons */
    .reasons-section {
      margin-top: 20px;
    }

    .reasons-title {
      font-size: 13px;
      color: var(--text3);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    .reason-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--red-bg);
      border: 1px solid rgba(239, 68, 68, 0.2);
      border-radius: 6px;
      color: var(--red);
      font-size: 13px;
      font-weight: 500;
      margin: 0 6px 6px 0;
      animation: tagSlide 0.3s ease-out backwards;
    }

    .reason-tag:nth-child(1) {
      animation-delay: 0.1s;
    }

    .reason-tag:nth-child(2) {
      animation-delay: 0.2s;
    }

    .reason-tag:nth-child(3) {
      animation-delay: 0.3s;
    }

    .reason-tag:nth-child(4) {
      animation-delay: 0.4s;
    }

    .no-reasons {
      color: var(--green);
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    @keyframes tagSlide {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   History Table
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .history-table {
      width: 100%;
      border-collapse: collapse;
    }

    .history-table th {
      text-align: left;
      padding: 10px 14px;
      font-size: 11px;
      color: var(--text3);
      text-transform: uppercase;
      letter-spacing: 1px;
      border-bottom: 1px solid var(--border);
    }

    .history-table td {
      padding: 12px 14px;
      font-size: 13px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.03);
      vertical-align: middle;
    }

    .history-table tr {
      transition: background 0.2s;
    }

    .history-table tbody tr:hover {
      background: var(--glass);
    }

    .history-table .score-cell {
      font-weight: 700;
      font-variant-numeric: tabular-nums;
    }

    .empty-state {
      text-align: center;
      padding: 50px 20px;
      color: var(--text3);
    }

    .empty-state .empty-icon {
      font-size: 40px;
      margin-bottom: 12px;
    }

    /* Mini risk pill in table */
    .risk-pill {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Responsive
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width: 900px) {
      .main-grid {
        grid-template-columns: 1fr;
      }

      .stats-bar {
        grid-template-columns: repeat(2, 1fr);
      }

      .container {
        padding: 16px;
      }

      .navbar {
        padding: 0 16px;
      }
    }

    @media (max-width: 500px) {
      .stats-bar {
        grid-template-columns: 1fr;
      }

      .form-row {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <div class="app">

    <!-- â•â•â• Navbar â•â•â• -->
    <nav class="navbar">
      <h1><span>ğŸ›¡ï¸</span> Fraud Detection Dashboard</h1>
      <div class="status-pill">
        <div class="status-dot"></div> <span id="nav-status">Connectingâ€¦</span>
      </div>
    </nav>

    <!-- â•â•â• Container â•â•â• -->
    <div class="container">

      <!-- Stats Bar -->
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-label">Models Active</div>
          <div class="stat-value" id="st-models">â€”</div>
          <div class="stat-sub" id="st-models-list"></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Primary Model</div>
          <div class="stat-value" id="st-primary">â€”</div>
          <div class="stat-sub">Highest priority</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Predictions</div>
          <div class="stat-value" id="st-preds">0</div>
          <div class="stat-sub" id="st-preds-sub">This session</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Avg Latency</div>
          <div class="stat-value" id="st-latency">â€”</div>
          <div class="stat-sub">milliseconds</div>
        </div>
      </div>

      <!-- Main Grid -->
      <div class="main-grid">

        <!-- Left: Form -->
        <div class="card">
          <div class="card-header">âš¡ Score Transaction</div>
          <div class="card-body">

            <!-- Presets -->
            <div class="presets">
              <div class="presets-label">Quick presets</div>
              <div class="preset-btns">
                <button class="preset-btn" onclick="fillPreset('legit')">âœ… Normal $30</button>
                <button class="preset-btn" onclick="fillPreset('mid')">âš ï¸ Medium $1.2K</button>
                <button class="preset-btn" onclick="fillPreset('suspicious')">ğŸš¨ Suspicious $8K</button>
                <button class="preset-btn" onclick="fillPreset('fraud')">ğŸ’€ High Risk $15K</button>
              </div>
            </div>

            <form id="txnForm" onsubmit="return scoreTransaction(event)">
              <div class="form-group">
                <label>Transaction ID</label>
                <input type="text" id="f-txnid" value="" placeholder="TXN-0001" required>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Amount ($)</label>
                  <input type="number" id="f-amount" step="0.01" min="0.01" placeholder="299.99" required>
                </div>
                <div class="form-group">
                  <label>Product Code</label>
                  <select id="f-product">
                    <option value="W">W â€” Web</option>
                    <option value="H">H â€” Home</option>
                    <option value="C">C â€” Corporate</option>
                    <option value="S">S â€” Services</option>
                    <option value="R">R â€” Retail</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>User ID</label>
                  <input type="text" id="f-user" placeholder="USER001" required>
                </div>
                <div class="form-group">
                  <label>Merchant ID</label>
                  <input type="text" id="f-merchant" placeholder="MERCH_789" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Card Type</label>
                  <select id="f-card">
                    <option value="visa">Visa</option>
                    <option value="mastercard">Mastercard</option>
                    <option value="discover">Discover</option>
                    <option value="amex">American Express</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>Device</label>
                  <input type="text" id="f-device" placeholder="iOS / Android / Chrome">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Email Domain</label>
                  <input type="text" id="f-email" placeholder="gmail.com">
                </div>
                <div class="form-group">
                  <label>Timestamp</label>
                  <input type="datetime-local" id="f-time">
                </div>
              </div>
              <button type="submit" class="btn-score" id="btn-score">
                <div class="spinner"></div>
                <span class="btn-text">ğŸ” Analyze Transaction</span>
              </button>
            </form>
          </div>
        </div>

        <!-- Right Column -->
        <div>
          <!-- Result Panel -->
          <div class="card result-panel" id="result-panel">
            <div class="card-header">ğŸ“Š Analysis Result</div>
            <div class="card-body">
              <div class="gauge-wrap">
                <div class="gauge-container">
                  <svg class="gauge-svg" viewBox="0 0 220 130">
                    <path class="gauge-bg" d="M 20 120 A 90 90 0 0 1 200 120" />
                    <path class="gauge-fill" id="gauge-fill" d="M 20 120 A 90 90 0 0 1 200 120" />
                  </svg>
                  <div class="gauge-score" id="gauge-score">â€”</div>
                </div>
                <div class="gauge-label">Fraud Probability</div>
                <div class="risk-badge" id="risk-badge">â€”</div>
              </div>
              <div class="result-details" id="result-details"></div>
              <div class="reasons-section" id="reasons-section"></div>
            </div>
          </div>

          <!-- History -->
          <div class="card" style="margin-top:20px;">
            <div class="card-header">ğŸ“œ Recent Predictions</div>
            <div class="card-body" style="padding:0;">
              <div id="history-content">
                <div class="empty-state">
                  <div class="empty-icon">ğŸ”®</div>
                  <div>No predictions yet. Score a transaction to get started!</div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       State
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const API = '';  // same origin
    let history = [];
    let txnCounter = 1;

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       Init
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    document.addEventListener('DOMContentLoaded', () => {
      setDefaultTime();
      generateTxnId();
      loadStats();
      setInterval(loadStats, 15000);
    });

    function setDefaultTime() {
      const now = new Date();
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      document.getElementById('f-time').value = now.toISOString().slice(0, 16);
    }

    function generateTxnId() {
      document.getElementById('f-txnid').value = 'TXN-' + String(txnCounter++).padStart(4, '0');
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       Stats
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    async function loadStats() {
      try {
        const r = await fetch(API + '/stats');
        const d = await r.json();
        document.getElementById('st-models').textContent = d.models_loaded.filter(m => m !== 'none').length;
        document.getElementById('st-models-list').textContent = d.models_loaded.join(', ');
        document.getElementById('st-primary').textContent = d.primary_model;
        document.getElementById('st-preds').textContent = d.total_predictions.toLocaleString();
        document.getElementById('st-latency').textContent = d.average_latency_ms.toFixed(1) + ' ms';
        document.getElementById('nav-status').textContent = d.models_loaded.filter(m => m !== 'none').length + ' Models Online';
      } catch (e) {
        document.getElementById('nav-status').textContent = 'Offline';
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       Presets
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    const PRESETS = {
      legit: { amount: 29.99, product: 'W', user: 'USR_1001', merchant: 'AMZN_01', card: 'visa', device: 'Chrome', email: 'john@gmail.com', hourOffset: 14 },
      mid: { amount: 1249.00, product: 'S', user: 'USR_4420', merchant: 'LUXURY_88', card: 'mastercard', device: 'iOS', email: 'buyer@yahoo.com', hourOffset: 22 },
      suspicious: { amount: 7999.99, product: 'R', user: 'USR_9091', merchant: 'UNKNOWN_X', card: 'discover', device: '', email: '', hourOffset: 3 },
      fraud: { amount: 14999.00, product: 'C', user: 'USR_0007', merchant: 'OFFSHORE_1', card: 'amex', device: '', email: '', hourOffset: 2 },
    };

    function fillPreset(key) {
      const p = PRESETS[key];
      document.getElementById('f-amount').value = p.amount;
      document.getElementById('f-product').value = p.product;
      document.getElementById('f-user').value = p.user;
      document.getElementById('f-merchant').value = p.merchant;
      document.getElementById('f-card').value = p.card;
      document.getElementById('f-device').value = p.device;
      document.getElementById('f-email').value = p.email;
      const d = new Date();
      d.setHours(p.hourOffset, Math.floor(Math.random() * 60), 0);
      d.setMinutes(d.getMinutes() - d.getTimezoneOffset() + d.getMinutes());
      // Simpler: just set the hour
      const now = new Date();
      now.setHours(p.hourOffset, 0, 0);
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      document.getElementById('f-time').value = now.toISOString().slice(0, 16);
      generateTxnId();
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       Score Transaction
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    async function scoreTransaction(e) {
      e.preventDefault();
      const btn = document.getElementById('btn-score');
      btn.classList.add('loading');
      btn.disabled = true;

      const body = {
        transaction_id: document.getElementById('f-txnid').value,
        user_id: document.getElementById('f-user').value,
        transaction_amount: parseFloat(document.getElementById('f-amount').value),
        merchant_id: document.getElementById('f-merchant').value,
        product_code: document.getElementById('f-product').value,
        card_type: document.getElementById('f-card').value,
      };
      const dev = document.getElementById('f-device').value.trim();
      if (dev) body.device_info = dev;
      const em = document.getElementById('f-email').value.trim();
      if (em) body.email_domain = em;
      const ts = document.getElementById('f-time').value;
      if (ts) body.transaction_timestamp = ts;

      try {
        const r = await fetch(API + '/score', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body),
        });
        if (!r.ok) throw new Error('API error: ' + r.status);
        const d = await r.json();
        showResult(d, body.transaction_amount);
        addHistory(d, body.transaction_amount);
        loadStats();
        generateTxnId();
      } catch (err) {
        alert('Error: ' + err.message);
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       Display Result
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function showResult(d, amount) {
      const panel = document.getElementById('result-panel');
      panel.classList.add('visible');

      // Gauge
      const arc = 282.6; // approx circumference of the arc path
      const fillPath = document.getElementById('gauge-fill');
      fillPath.style.strokeDasharray = arc;
      fillPath.style.strokeDashoffset = arc;

      const score = d.fraud_score;
      const color = score < 0.2 ? 'var(--green)' : score < 0.4 ? '#22c55e' : score < 0.6 ? 'var(--yellow)' : score < 0.8 ? 'var(--orange)' : 'var(--critical)';

      requestAnimationFrame(() => {
        fillPath.style.strokeDashoffset = arc * (1 - score);
        fillPath.style.stroke = color;
      });

      const scoreEl = document.getElementById('gauge-score');
      scoreEl.style.color = color;
      animateNumber(scoreEl, score, 1200);

      // Risk badge
      const badge = document.getElementById('risk-badge');
      badge.className = 'risk-badge risk-' + d.risk_level;
      const icons = { MINIMAL: 'âœ…', LOW: 'ğŸŸ¢', MEDIUM: 'âš ï¸', HIGH: 'ğŸ”¶', CRITICAL: 'ğŸš¨' };
      badge.innerHTML = (icons[d.risk_level] || '') + ' ' + d.risk_level;

      // Details
      document.getElementById('result-details').innerHTML = `
    <div class="detail-row"><span class="detail-key">Transaction</span><span class="detail-val">${d.transaction_id}</span></div>
    <div class="detail-row"><span class="detail-key">Amount</span><span class="detail-val">$${amount.toLocaleString(undefined, { minimumFractionDigits: 2 })}</span></div>
    <div class="detail-row"><span class="detail-key">Model</span><span class="detail-val">${d.model_used}</span></div>
    <div class="detail-row"><span class="detail-key">Confidence</span><span class="detail-val">${(d.confidence * 100).toFixed(1)}%</span></div>
    <div class="detail-row"><span class="detail-key">Latency</span><span class="detail-val">${d.processing_time_ms.toFixed(1)} ms</span></div>
    <div class="detail-row"><span class="detail-key">Verdict</span><span class="detail-val" style="color:${d.is_fraud ? 'var(--red)' : 'var(--green)'}">${d.is_fraud ? 'ğŸš« Blocked' : 'âœ… Approved'}</span></div>
  `;

      // Reasons
      const rs = document.getElementById('reasons-section');
      if (d.reasons && d.reasons.length) {
        rs.innerHTML = '<div class="reasons-title">âš ï¸ Risk Factors</div>' + d.reasons.map(r => `<span class="reason-tag">âš¡ ${r}</span>`).join('');
      } else {
        rs.innerHTML = '<div class="reasons-title">Risk Factors</div><div class="no-reasons">âœ… No risk factors detected</div>';
      }

      panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function animateNumber(el, target, duration) {
      const start = performance.now();
      const update = (now) => {
        const t = Math.min((now - start) / duration, 1);
        const ease = 1 - Math.pow(1 - t, 3); // ease-out cubic
        el.textContent = (target * ease).toFixed(2);
        if (t < 1) requestAnimationFrame(update);
      };
      requestAnimationFrame(update);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       History
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    function addHistory(d, amount) {
      history.unshift({ ...d, amount, time: new Date() });
      if (history.length > 20) history.pop();
      renderHistory();
    }

    function renderHistory() {
      if (!history.length) return;
      const riskColor = { MINIMAL: 'var(--green)', LOW: 'var(--green)', MEDIUM: 'var(--yellow)', HIGH: 'var(--orange)', CRITICAL: 'var(--critical)' };
      const riskBg = { MINIMAL: 'var(--green-bg)', LOW: 'var(--green-bg)', MEDIUM: 'var(--yellow-bg)', HIGH: 'var(--orange-bg)', CRITICAL: 'var(--critical-bg)' };

      let html = '<table class="history-table"><thead><tr><th>ID</th><th>Amount</th><th>Score</th><th>Risk</th><th>Model</th><th>Latency</th></tr></thead><tbody>';
      for (const h of history) {
        html += `<tr>
      <td>${h.transaction_id}</td>
      <td>$${h.amount.toLocaleString(undefined, { minimumFractionDigits: 2 })}</td>
      <td class="score-cell" style="color:${riskColor[h.risk_level]}">${h.fraud_score.toFixed(4)}</td>
      <td><span class="risk-pill" style="background:${riskBg[h.risk_level]};color:${riskColor[h.risk_level]}">${h.risk_level}</span></td>
      <td>${h.model_used}</td>
      <td>${h.processing_time_ms.toFixed(1)} ms</td>
    </tr>`;
      }
      html += '</tbody></table>';
      document.getElementById('history-content').innerHTML = html;
    }
  </script>
</body>

</html>